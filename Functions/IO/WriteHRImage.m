function WriteHRImage(HRImage, fileName)
%--------------------------------------------------------------------------
% WriteHRImage(HRImage, fileName)
% This function saves a .hrf file to fileName
%--------------------------------------------------------------------------
% Inputs:
% HRImage/struct/(required): A high resolution image structure
% 
% fileName/string/([]): The path and file name of the new .hrf file
%
%--------------------------------------------------------------------------
% Outputs:
%
%--------------------------------------------------------------------------
% Variable Inputs:
%
%--------------------------------------------------------------------------
% Jeffrey Moffitt
% October 9, 2012
% jeffmoffitt@gmail.com
%
% Version 1.0
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
% Hardcoded Variables
%--------------------------------------------------------------------------
headerSize = 100; 
verbose = false;

%--------------------------------------------------------------------------
% Global Variables
%--------------------------------------------------------------------------
global dataDefaultPath;

%--------------------------------------------------------------------------
% Default Variables
%--------------------------------------------------------------------------

%--------------------------------------------------------------------------
% Parse Required Input
%--------------------------------------------------------------------------
if nargin < 1
    error('HRImage structure required');
end
if nargin < 2
    fileName = HRImage.name;
end

%--------------------------------------------------------------------------
% Open File
%--------------------------------------------------------------------------
fid = fopen(fileName, 'w');
if fid < 0
    error(['Could not open ' fileName]);
end

%--------------------------------------------------------------------------
% Write Header
%--------------------------------------------------------------------------
fwrite(fid, HRImage.dim, 'int32');
fwrite(fid, int8(zeros(1,92)),'int8');

%--------------------------------------------------------------------------
% Write HRImage Structure
%--------------------------------------------------------------------------
for i=1:length(HRImage.frame)
   fwrite(fid, HRImage.frame(i), 'int32');
   fwrite(fid, HRImage.pixelInd(i), 'int32');
   fwrite(fid, HRImage.intensity(i), 'single');
end

%--------------------------------------------------------------------------
% Close File
%--------------------------------------------------------------------------
fclose(fid);